(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[587],{1668:(s,e,n)=>{"use strict";n.d(e,{R:()=>c});var l=n(4232);let a=l.createContext({});function c(s){let e=l.useContext(a);return l.useMemo(function(){return"function"==typeof s?s(e):{...e,...s}},[e,s])}},2120:(s,e,n)=>{"use strict";function l(s){return new Date(`${s}T00:00:00Z`).toLocaleDateString("en-US",{day:"numeric",month:"long",year:"numeric",timeZone:"UTC"})}n.d(e,{Y:()=>l})},7328:(s,e,n)=>{s.exports=n(9836)},7898:(s,e,n)=>{(window.__NEXT_P=window.__NEXT_P||[]).push(["/articles/rust-dyn-traits-example",function(){return n(9826)}])},9172:(s,e,n)=>{"use strict";n.d(e,{T:()=>j});var l=n(7876),a=n(7328),c=n.n(a),t=n(5587),h=n(2120),i=n(9241);function r({children:s,className:e}){return(0,l.jsx)("div",{className:(0,i.A)(e,"prose dark:prose-invert"),children:s})}function j({children:s,meta:e,isRssFeed:n=!1,previousPathname:a}){return n?s:(0,l.jsxs)(l.Fragment,{children:[(0,l.jsxs)(c(),{children:[(0,l.jsx)("title",{children:`${e.title} - Daniel Butler`}),(0,l.jsx)("meta",{name:"description",content:e.description})]}),(0,l.jsx)(t.m,{className:"mt-16 lg:mt-32",children:(0,l.jsx)("div",{className:"xl:relative",children:(0,l.jsx)("div",{className:"mx-auto max-w-2xl",children:(0,l.jsxs)("article",{children:[(0,l.jsxs)("header",{className:"flex flex-col",children:[(0,l.jsx)("h1",{className:"mt-6 text-4xl font-bold tracking-tight text-zinc-800 dark:text-zinc-100 sm:text-5xl",children:e.title}),(0,l.jsxs)("time",{dateTime:e.date,className:"order-first flex items-center text-base text-zinc-400 dark:text-zinc-500",children:[(0,l.jsx)("span",{className:"h-4 w-0.5 rounded-full bg-zinc-200 dark:bg-zinc-500"}),(0,l.jsx)("span",{className:"ml-3",children:(0,h.Y)(e.date)})]})]}),(0,l.jsx)(r,{className:"mt-8",children:s})]})})})})]})}},9826:(s,e,n)=>{"use strict";n.r(e),n.d(e,{default:()=>r,meta:()=>t});var l=n(7876),a=n(1668),c=n(9172);let t={author:"Daniel Butler",date:"2023-05-05",title:"Rust Book Dynamic Traits Example",description:"Expanding on the example in Rust Book's chapter 17 section 3. Refactored with ChatGPT 4s help."},h=s=>(0,l.jsx)(c.T,{meta:t,...s});function i(s){let e={a:"a",blockquote:"blockquote",code:"code",h2:"h2",h3:"h3",li:"li",ol:"ol",p:"p",pre:"pre",span:"span",ul:"ul",...(0,a.R)(),...s.components};return(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(e.h2,{children:"Overview"}),"\n",(0,l.jsxs)(e.p,{children:["The example comes from the prompt below in the ",(0,l.jsx)(e.a,{href:"https://doc.rust-lang.org/book/ch17-03-oo-design-patterns.html",children:"rust book's chapter 17 section 3"}),"."]}),"\n",(0,l.jsxs)(e.blockquote,{children:["\n",(0,l.jsx)(e.p,{children:"To see the simplicity of maintaining code that uses the state pattern, try a few of these suggestions:"}),"\n",(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsxs)(e.li,{children:["Add a\xa0",(0,l.jsx)(e.code,{children:"reject"}),"\xa0method that changes the postâ€™s state from\xa0",(0,l.jsx)(e.code,{children:"PendingReview"}),"\xa0back to\xa0",(0,l.jsx)(e.code,{children:"Draft"}),"."]}),"\n",(0,l.jsxs)(e.li,{children:["Require two calls to\xa0",(0,l.jsx)(e.code,{children:"approve"}),"\xa0before the state can be changed to\xa0",(0,l.jsx)(e.code,{children:"Published"}),"."]}),"\n",(0,l.jsxs)(e.li,{children:["Allow users to add text content only when a post is in the\xa0",(0,l.jsx)(e.code,{children:"Draft"}),"\xa0state. Hint: have the state object responsible for what might change about the content but not responsible for modifying the\xa0",(0,l.jsx)(e.code,{children:"Post"}),"."]}),"\n"]}),"\n"]}),"\n",(0,l.jsx)(e.h3,{children:"Result"}),"\n",(0,l.jsxs)(e.p,{children:["Below is the code I wrote to solve the three challenges above. I struggled with getting the value for the ",(0,l.jsx)(e.code,{children:"Optional<Box<...>>"}),". I'm starting to grasp that it all goes back to the types when working with rust. Types are not as big of a deal in Python, so that is taking some getting used to."]}),"\n",(0,l.jsx)(e.pre,{children:(0,l.jsxs)(e.code,{className:"hljs language-rust",children:[(0,l.jsx)(e.span,{className:"hljs-keyword",children:"use"})," blog::Post;\n\n",(0,l.jsx)(e.span,{className:"hljs-keyword",children:"fn"})," ",(0,l.jsx)(e.span,{className:"hljs-title function_",children:"main"}),"() {\n    ",(0,l.jsx)(e.span,{className:"hljs-keyword",children:"let"})," ",(0,l.jsx)(e.span,{className:"hljs-keyword",children:"mut "}),(0,l.jsx)(e.span,{className:"hljs-variable",children:"post"})," = Post::",(0,l.jsx)(e.span,{className:"hljs-title function_ invoke__",children:"new"}),"();\n\n    post.",(0,l.jsx)(e.span,{className:"hljs-title function_ invoke__",children:"add_text"}),"(",(0,l.jsx)(e.span,{className:"hljs-string",children:'"I ate a salad for lunch today"'}),");\n    ",(0,l.jsx)(e.span,{className:"hljs-built_in",children:"assert_eq!"}),"(",(0,l.jsx)(e.span,{className:"hljs-string",children:'""'}),", post.",(0,l.jsx)(e.span,{className:"hljs-title function_ invoke__",children:"content"}),"());\n\n    post.",(0,l.jsx)(e.span,{className:"hljs-title function_ invoke__",children:"request_review"}),"();\n    ",(0,l.jsx)(e.span,{className:"hljs-built_in",children:"assert_eq!"}),"(",(0,l.jsx)(e.span,{className:"hljs-string",children:'""'}),", post.",(0,l.jsx)(e.span,{className:"hljs-title function_ invoke__",children:"content"}),"());\n	\n	post.",(0,l.jsx)(e.span,{className:"hljs-title function_ invoke__",children:"reject"}),"();\n	",(0,l.jsx)(e.span,{className:"hljs-built_in",children:"assert_eq!"}),"(",(0,l.jsx)(e.span,{className:"hljs-string",children:'""'}),", post.",(0,l.jsx)(e.span,{className:"hljs-title function_ invoke__",children:"content"}),"());\n	\n	post.",(0,l.jsx)(e.span,{className:"hljs-title function_ invoke__",children:"request_review"}),"();\n    ",(0,l.jsx)(e.span,{className:"hljs-built_in",children:"assert_eq!"}),"(",(0,l.jsx)(e.span,{className:"hljs-string",children:'""'}),", post.",(0,l.jsx)(e.span,{className:"hljs-title function_ invoke__",children:"content"}),"());\n	\n	post.",(0,l.jsx)(e.span,{className:"hljs-title function_ invoke__",children:"approve"}),"();\n	post.",(0,l.jsx)(e.span,{className:"hljs-title function_ invoke__",children:"approve"}),"();\n	",(0,l.jsx)(e.span,{className:"hljs-built_in",children:"assert_eq!"}),"(",(0,l.jsx)(e.span,{className:"hljs-string",children:'"I ate a salad for lunch today"'}),", post.",(0,l.jsx)(e.span,{className:"hljs-title function_ invoke__",children:"content"}),"());\n}\n\n\n",(0,l.jsx)(e.span,{className:"hljs-keyword",children:"mod"})," blog {\n	",(0,l.jsx)(e.span,{className:"hljs-keyword",children:"pub"})," ",(0,l.jsx)(e.span,{className:"hljs-keyword",children:"struct"})," ",(0,l.jsx)(e.span,{className:"hljs-title class_",children:"Post"})," {\n		state: ",(0,l.jsx)(e.span,{className:"hljs-type",children:"Option"}),"<",(0,l.jsx)(e.span,{className:"hljs-type",children:"Box"}),"<",(0,l.jsx)(e.span,{className:"hljs-keyword",children:"dyn"})," State>>,\n		content: ",(0,l.jsx)(e.span,{className:"hljs-type",children:"String"}),",\n	}\n	\n	",(0,l.jsx)(e.span,{className:"hljs-keyword",children:"impl"})," ",(0,l.jsx)(e.span,{className:"hljs-title class_",children:"Post"})," {\n		",(0,l.jsx)(e.span,{className:"hljs-keyword",children:"pub"})," ",(0,l.jsx)(e.span,{className:"hljs-keyword",children:"fn"})," ",(0,l.jsx)(e.span,{className:"hljs-title function_",children:"new"}),"() ",(0,l.jsx)(e.span,{className:"hljs-punctuation",children:"->"})," Post {\n			Post {\n				state: ",(0,l.jsx)(e.span,{className:"hljs-title function_ invoke__",children:"Some"}),"(",(0,l.jsx)(e.span,{className:"hljs-type",children:"Box"}),"::",(0,l.jsx)(e.span,{className:"hljs-title function_ invoke__",children:"new"}),"(Draft {})),\n				content: ",(0,l.jsx)(e.span,{className:"hljs-type",children:"String"}),"::",(0,l.jsx)(e.span,{className:"hljs-title function_ invoke__",children:"new"}),"(),\n			}\n		}\n		\n		",(0,l.jsx)(e.span,{className:"hljs-keyword",children:"pub"})," ",(0,l.jsx)(e.span,{className:"hljs-keyword",children:"fn"})," ",(0,l.jsx)(e.span,{className:"hljs-title function_",children:"add_text"}),"(&",(0,l.jsx)(e.span,{className:"hljs-keyword",children:"mut"})," ",(0,l.jsx)(e.span,{className:"hljs-keyword",children:"self"}),", text: &",(0,l.jsx)(e.span,{className:"hljs-type",children:"str"}),") {\n			",(0,l.jsx)(e.span,{className:"hljs-keyword",children:"if"})," ",(0,l.jsx)(e.span,{className:"hljs-keyword",children:"let"})," ",(0,l.jsx)(e.span,{className:"hljs-variable",children:"Some"}),"(s) = ",(0,l.jsx)(e.span,{className:"hljs-keyword",children:"self"}),".state.",(0,l.jsx)(e.span,{className:"hljs-title function_ invoke__",children:"as_ref"}),"() {\n				",(0,l.jsx)(e.span,{className:"hljs-built_in",children:"println!"}),"(",(0,l.jsx)(e.span,{className:"hljs-string",children:'"Can add content: {}"'}),", s.",(0,l.jsx)(e.span,{className:"hljs-title function_ invoke__",children:"can_add_content"}),"());\n			\n				",(0,l.jsx)(e.span,{className:"hljs-keyword",children:"if"})," s.",(0,l.jsx)(e.span,{className:"hljs-title function_ invoke__",children:"can_add_content"}),"() {\n					",(0,l.jsx)(e.span,{className:"hljs-keyword",children:"self"}),".content.",(0,l.jsx)(e.span,{className:"hljs-title function_ invoke__",children:"push_str"}),"(text);\n				}\n			}\n		}\n		\n		",(0,l.jsx)(e.span,{className:"hljs-keyword",children:"pub"})," ",(0,l.jsx)(e.span,{className:"hljs-keyword",children:"fn"})," ",(0,l.jsx)(e.span,{className:"hljs-title function_",children:"content"}),"(&",(0,l.jsx)(e.span,{className:"hljs-keyword",children:"self"}),") ",(0,l.jsx)(e.span,{className:"hljs-punctuation",children:"->"})," &",(0,l.jsx)(e.span,{className:"hljs-type",children:"str"})," {\n			",(0,l.jsx)(e.span,{className:"hljs-keyword",children:"let"})," ",(0,l.jsx)(e.span,{className:"hljs-variable",children:"content"})," = ",(0,l.jsx)(e.span,{className:"hljs-keyword",children:"self"}),".state.",(0,l.jsx)(e.span,{className:"hljs-title function_ invoke__",children:"as_ref"}),"().",(0,l.jsx)(e.span,{className:"hljs-title function_ invoke__",children:"unwrap"}),"().",(0,l.jsx)(e.span,{className:"hljs-title function_ invoke__",children:"content"}),"(",(0,l.jsx)(e.span,{className:"hljs-keyword",children:"self"}),");\n			",(0,l.jsx)(e.span,{className:"hljs-built_in",children:"println!"}),"(",(0,l.jsx)(e.span,{className:"hljs-string",children:'"content: {}"'}),", content);\n			content\n		}\n		\n		",(0,l.jsx)(e.span,{className:"hljs-keyword",children:"pub"})," ",(0,l.jsx)(e.span,{className:"hljs-keyword",children:"fn"})," ",(0,l.jsx)(e.span,{className:"hljs-title function_",children:"request_review"}),"(&",(0,l.jsx)(e.span,{className:"hljs-keyword",children:"mut"})," ",(0,l.jsx)(e.span,{className:"hljs-keyword",children:"self"}),") {\n			",(0,l.jsx)(e.span,{className:"hljs-keyword",children:"if"})," ",(0,l.jsx)(e.span,{className:"hljs-keyword",children:"let"})," ",(0,l.jsx)(e.span,{className:"hljs-variable",children:"Some"}),"(s) = ",(0,l.jsx)(e.span,{className:"hljs-keyword",children:"self"}),".state.",(0,l.jsx)(e.span,{className:"hljs-title function_ invoke__",children:"take"}),"() {\n				",(0,l.jsx)(e.span,{className:"hljs-keyword",children:"self"}),".state = ",(0,l.jsx)(e.span,{className:"hljs-title function_ invoke__",children:"Some"}),"(s.",(0,l.jsx)(e.span,{className:"hljs-title function_ invoke__",children:"request_review"}),"())\n			}\n		}\n		\n		",(0,l.jsx)(e.span,{className:"hljs-keyword",children:"pub"})," ",(0,l.jsx)(e.span,{className:"hljs-keyword",children:"fn"})," ",(0,l.jsx)(e.span,{className:"hljs-title function_",children:"approve"}),"(&",(0,l.jsx)(e.span,{className:"hljs-keyword",children:"mut"})," ",(0,l.jsx)(e.span,{className:"hljs-keyword",children:"self"}),") {\n			",(0,l.jsx)(e.span,{className:"hljs-keyword",children:"if"})," ",(0,l.jsx)(e.span,{className:"hljs-keyword",children:"let"})," ",(0,l.jsx)(e.span,{className:"hljs-variable",children:"Some"}),"(s) = ",(0,l.jsx)(e.span,{className:"hljs-keyword",children:"self"}),".state.",(0,l.jsx)(e.span,{className:"hljs-title function_ invoke__",children:"take"}),"() {\n				",(0,l.jsx)(e.span,{className:"hljs-keyword",children:"self"}),".state = ",(0,l.jsx)(e.span,{className:"hljs-title function_ invoke__",children:"Some"}),"(s.",(0,l.jsx)(e.span,{className:"hljs-title function_ invoke__",children:"approve"}),"());\n			}\n		}\n		\n		",(0,l.jsx)(e.span,{className:"hljs-keyword",children:"pub"})," ",(0,l.jsx)(e.span,{className:"hljs-keyword",children:"fn"})," ",(0,l.jsx)(e.span,{className:"hljs-title function_",children:"reject"}),"(&",(0,l.jsx)(e.span,{className:"hljs-keyword",children:"mut"})," ",(0,l.jsx)(e.span,{className:"hljs-keyword",children:"self"}),") {\n			",(0,l.jsx)(e.span,{className:"hljs-keyword",children:"if"})," ",(0,l.jsx)(e.span,{className:"hljs-keyword",children:"let"})," ",(0,l.jsx)(e.span,{className:"hljs-variable",children:"Some"}),"(s) = ",(0,l.jsx)(e.span,{className:"hljs-keyword",children:"self"}),".state.",(0,l.jsx)(e.span,{className:"hljs-title function_ invoke__",children:"take"}),"() {\n				",(0,l.jsx)(e.span,{className:"hljs-keyword",children:"self"}),".state = ",(0,l.jsx)(e.span,{className:"hljs-title function_ invoke__",children:"Some"}),"(s.",(0,l.jsx)(e.span,{className:"hljs-title function_ invoke__",children:"reject"}),"());\n			}\n		}\n	}\n	\n	",(0,l.jsx)(e.span,{className:"hljs-keyword",children:"trait"})," ",(0,l.jsx)(e.span,{className:"hljs-title class_",children:"State"})," {\n		",(0,l.jsx)(e.span,{className:"hljs-keyword",children:"fn"})," ",(0,l.jsx)(e.span,{className:"hljs-title function_",children:"request_review"}),"(",(0,l.jsx)(e.span,{className:"hljs-keyword",children:"self"}),": ",(0,l.jsx)(e.span,{className:"hljs-type",children:"Box"}),"<",(0,l.jsx)(e.span,{className:"hljs-keyword",children:"Self"}),">) ",(0,l.jsx)(e.span,{className:"hljs-punctuation",children:"->"})," ",(0,l.jsx)(e.span,{className:"hljs-type",children:"Box"}),"<",(0,l.jsx)(e.span,{className:"hljs-keyword",children:"dyn"})," State>;\n		",(0,l.jsx)(e.span,{className:"hljs-keyword",children:"fn"})," ",(0,l.jsx)(e.span,{className:"hljs-title function_",children:"approve"}),"(",(0,l.jsx)(e.span,{className:"hljs-keyword",children:"self"}),": ",(0,l.jsx)(e.span,{className:"hljs-type",children:"Box"}),"<",(0,l.jsx)(e.span,{className:"hljs-keyword",children:"Self"}),">) ",(0,l.jsx)(e.span,{className:"hljs-punctuation",children:"->"})," ",(0,l.jsx)(e.span,{className:"hljs-type",children:"Box"}),"<",(0,l.jsx)(e.span,{className:"hljs-keyword",children:"dyn"})," State>;\n		",(0,l.jsx)(e.span,{className:"hljs-keyword",children:"fn"})," ",(0,l.jsx)(e.span,{className:"hljs-title function_",children:"reject"}),"(",(0,l.jsx)(e.span,{className:"hljs-keyword",children:"self"}),": ",(0,l.jsx)(e.span,{className:"hljs-type",children:"Box"}),"<",(0,l.jsx)(e.span,{className:"hljs-keyword",children:"Self"}),">) ",(0,l.jsx)(e.span,{className:"hljs-punctuation",children:"->"})," ",(0,l.jsx)(e.span,{className:"hljs-type",children:"Box"}),"<",(0,l.jsx)(e.span,{className:"hljs-keyword",children:"dyn"})," State>;\n		",(0,l.jsx)(e.span,{className:"hljs-keyword",children:"fn"})," ",(0,l.jsx)(e.span,{className:"hljs-title function_",children:"content"}),"<",(0,l.jsx)(e.span,{className:"hljs-symbol",children:"'a"}),">(&",(0,l.jsx)(e.span,{className:"hljs-keyword",children:"self"}),", _post: &",(0,l.jsx)(e.span,{className:"hljs-symbol",children:"'a"})," Post) ",(0,l.jsx)(e.span,{className:"hljs-punctuation",children:"->"})," &",(0,l.jsx)(e.span,{className:"hljs-symbol",children:"'a"})," ",(0,l.jsx)(e.span,{className:"hljs-type",children:"str"})," {\n		 	",(0,l.jsx)(e.span,{className:"hljs-string",children:'""'}),"\n		 }\n		",(0,l.jsx)(e.span,{className:"hljs-keyword",children:"fn"})," ",(0,l.jsx)(e.span,{className:"hljs-title function_",children:"can_add_content"}),"(&",(0,l.jsx)(e.span,{className:"hljs-keyword",children:"self"}),") ",(0,l.jsx)(e.span,{className:"hljs-punctuation",children:"->"})," ",(0,l.jsx)(e.span,{className:"hljs-type",children:"bool"})," {\n			",(0,l.jsx)(e.span,{className:"hljs-literal",children:"false"}),"\n		}\n	}\n\n	",(0,l.jsx)(e.span,{className:"hljs-keyword",children:"struct"})," ",(0,l.jsx)(e.span,{className:"hljs-title class_",children:"Draft"})," {}\n	\n	",(0,l.jsx)(e.span,{className:"hljs-keyword",children:"impl"})," ",(0,l.jsx)(e.span,{className:"hljs-title class_",children:"State"})," ",(0,l.jsx)(e.span,{className:"hljs-keyword",children:"for"})," ",(0,l.jsx)(e.span,{className:"hljs-title class_",children:"Draft"})," {\n		",(0,l.jsx)(e.span,{className:"hljs-keyword",children:"fn"})," ",(0,l.jsx)(e.span,{className:"hljs-title function_",children:"request_review"}),"(",(0,l.jsx)(e.span,{className:"hljs-keyword",children:"self"}),": ",(0,l.jsx)(e.span,{className:"hljs-type",children:"Box"}),"<",(0,l.jsx)(e.span,{className:"hljs-keyword",children:"Self"}),">) ",(0,l.jsx)(e.span,{className:"hljs-punctuation",children:"->"})," ",(0,l.jsx)(e.span,{className:"hljs-type",children:"Box"}),"<",(0,l.jsx)(e.span,{className:"hljs-keyword",children:"dyn"})," State> {\n			",(0,l.jsx)(e.span,{className:"hljs-type",children:"Box"}),"::",(0,l.jsx)(e.span,{className:"hljs-title function_ invoke__",children:"new"}),"(PendingReview::",(0,l.jsx)(e.span,{className:"hljs-title function_ invoke__",children:"new"}),"())\n		}\n		\n		",(0,l.jsx)(e.span,{className:"hljs-keyword",children:"fn"})," ",(0,l.jsx)(e.span,{className:"hljs-title function_",children:"approve"}),"(",(0,l.jsx)(e.span,{className:"hljs-keyword",children:"self"}),": ",(0,l.jsx)(e.span,{className:"hljs-type",children:"Box"}),"<",(0,l.jsx)(e.span,{className:"hljs-keyword",children:"Self"}),">) ",(0,l.jsx)(e.span,{className:"hljs-punctuation",children:"->"})," ",(0,l.jsx)(e.span,{className:"hljs-type",children:"Box"}),"<",(0,l.jsx)(e.span,{className:"hljs-keyword",children:"dyn"})," State> {\n		 	",(0,l.jsx)(e.span,{className:"hljs-keyword",children:"self"}),"\n		}\n		 \n		",(0,l.jsx)(e.span,{className:"hljs-keyword",children:"fn"})," ",(0,l.jsx)(e.span,{className:"hljs-title function_",children:"reject"}),"(",(0,l.jsx)(e.span,{className:"hljs-keyword",children:"self"}),": ",(0,l.jsx)(e.span,{className:"hljs-type",children:"Box"}),"<",(0,l.jsx)(e.span,{className:"hljs-keyword",children:"Self"}),">) ",(0,l.jsx)(e.span,{className:"hljs-punctuation",children:"->"})," ",(0,l.jsx)(e.span,{className:"hljs-type",children:"Box"}),"<",(0,l.jsx)(e.span,{className:"hljs-keyword",children:"dyn"})," State> {\n		 	",(0,l.jsx)(e.span,{className:"hljs-keyword",children:"self"}),"\n		}\n		 \n		",(0,l.jsx)(e.span,{className:"hljs-keyword",children:"fn"})," ",(0,l.jsx)(e.span,{className:"hljs-title function_",children:"can_add_content"}),"(&",(0,l.jsx)(e.span,{className:"hljs-keyword",children:"self"}),") ",(0,l.jsx)(e.span,{className:"hljs-punctuation",children:"->"})," ",(0,l.jsx)(e.span,{className:"hljs-type",children:"bool"})," {\n			",(0,l.jsx)(e.span,{className:"hljs-literal",children:"true"}),"\n		}\n	}\n	\n	",(0,l.jsx)(e.span,{className:"hljs-keyword",children:"struct"})," ",(0,l.jsx)(e.span,{className:"hljs-title class_",children:"PendingReview"})," {\n		reviews: ",(0,l.jsx)(e.span,{className:"hljs-type",children:"i8"}),"\n	}\n	",(0,l.jsx)(e.span,{className:"hljs-keyword",children:"impl"})," ",(0,l.jsx)(e.span,{className:"hljs-title class_",children:"PendingReview"})," {\n		",(0,l.jsx)(e.span,{className:"hljs-keyword",children:"pub"})," ",(0,l.jsx)(e.span,{className:"hljs-keyword",children:"fn"})," ",(0,l.jsx)(e.span,{className:"hljs-title function_",children:"new"}),"() ",(0,l.jsx)(e.span,{className:"hljs-punctuation",children:"->"})," PendingReview {\n			PendingReview { reviews: ",(0,l.jsx)(e.span,{className:"hljs-number",children:"0"})," }\n		}\n		\n		",(0,l.jsx)(e.span,{className:"hljs-keyword",children:"pub"})," ",(0,l.jsx)(e.span,{className:"hljs-keyword",children:"fn"})," ",(0,l.jsx)(e.span,{className:"hljs-title function_",children:"add_review"}),"(&",(0,l.jsx)(e.span,{className:"hljs-keyword",children:"mut"})," ",(0,l.jsx)(e.span,{className:"hljs-keyword",children:"self"}),") {\n			",(0,l.jsx)(e.span,{className:"hljs-keyword",children:"self"}),".reviews += ",(0,l.jsx)(e.span,{className:"hljs-number",children:"1"}),";\n		}\n		\n		",(0,l.jsx)(e.span,{className:"hljs-keyword",children:"pub"})," ",(0,l.jsx)(e.span,{className:"hljs-keyword",children:"fn"})," ",(0,l.jsx)(e.span,{className:"hljs-title function_",children:"get_reviews"}),"(&",(0,l.jsx)(e.span,{className:"hljs-keyword",children:"self"}),") ",(0,l.jsx)(e.span,{className:"hljs-punctuation",children:"->"})," ",(0,l.jsx)(e.span,{className:"hljs-type",children:"i8"})," {\n			",(0,l.jsx)(e.span,{className:"hljs-keyword",children:"self"}),".reviews\n		}\n	}\n	",(0,l.jsx)(e.span,{className:"hljs-keyword",children:"impl"})," ",(0,l.jsx)(e.span,{className:"hljs-title class_",children:"State"})," ",(0,l.jsx)(e.span,{className:"hljs-keyword",children:"for"})," ",(0,l.jsx)(e.span,{className:"hljs-title class_",children:"PendingReview"})," {\n		",(0,l.jsx)(e.span,{className:"hljs-keyword",children:"fn"})," ",(0,l.jsx)(e.span,{className:"hljs-title function_",children:"request_review"}),"(",(0,l.jsx)(e.span,{className:"hljs-keyword",children:"self"}),": ",(0,l.jsx)(e.span,{className:"hljs-type",children:"Box"}),"<",(0,l.jsx)(e.span,{className:"hljs-keyword",children:"Self"}),">) ",(0,l.jsx)(e.span,{className:"hljs-punctuation",children:"->"})," ",(0,l.jsx)(e.span,{className:"hljs-type",children:"Box"}),"<",(0,l.jsx)(e.span,{className:"hljs-keyword",children:"dyn"})," State> {\n			",(0,l.jsx)(e.span,{className:"hljs-keyword",children:"self"}),"\n		}\n		\n		",(0,l.jsx)(e.span,{className:"hljs-keyword",children:"fn"})," ",(0,l.jsx)(e.span,{className:"hljs-title function_",children:"approve"}),"(",(0,l.jsx)(e.span,{className:"hljs-keyword",children:"self"}),": ",(0,l.jsx)(e.span,{className:"hljs-type",children:"Box"}),"<",(0,l.jsx)(e.span,{className:"hljs-keyword",children:"Self"}),">) ",(0,l.jsx)(e.span,{className:"hljs-punctuation",children:"->"})," ",(0,l.jsx)(e.span,{className:"hljs-type",children:"Box"}),"<",(0,l.jsx)(e.span,{className:"hljs-keyword",children:"dyn"})," State> {\n			",(0,l.jsx)(e.span,{className:"hljs-keyword",children:"let"})," ",(0,l.jsx)(e.span,{className:"hljs-keyword",children:"mut "}),(0,l.jsx)(e.span,{className:"hljs-variable",children:"state"})," = PendingReview::",(0,l.jsx)(e.span,{className:"hljs-title function_ invoke__",children:"new"}),"();\n			state.",(0,l.jsx)(e.span,{className:"hljs-title function_ invoke__",children:"add_review"}),"();\n		\n			",(0,l.jsx)(e.span,{className:"hljs-keyword",children:"if"})," ",(0,l.jsx)(e.span,{className:"hljs-keyword",children:"self"}),".",(0,l.jsx)(e.span,{className:"hljs-title function_ invoke__",children:"as_ref"}),"().",(0,l.jsx)(e.span,{className:"hljs-title function_ invoke__",children:"get_reviews"}),"() == ",(0,l.jsx)(e.span,{className:"hljs-number",children:"0"})," {\n				",(0,l.jsx)(e.span,{className:"hljs-type",children:"Box"}),"::",(0,l.jsx)(e.span,{className:"hljs-title function_ invoke__",children:"new"}),"(state)\n			} ",(0,l.jsx)(e.span,{className:"hljs-keyword",children:"else"})," {\n				",(0,l.jsx)(e.span,{className:"hljs-type",children:"Box"}),"::",(0,l.jsx)(e.span,{className:"hljs-title function_ invoke__",children:"new"}),"(Published {})\n			}\n		}\n		\n		",(0,l.jsx)(e.span,{className:"hljs-keyword",children:"fn"})," ",(0,l.jsx)(e.span,{className:"hljs-title function_",children:"reject"}),"(",(0,l.jsx)(e.span,{className:"hljs-keyword",children:"self"}),": ",(0,l.jsx)(e.span,{className:"hljs-type",children:"Box"}),"<",(0,l.jsx)(e.span,{className:"hljs-keyword",children:"Self"}),">) ",(0,l.jsx)(e.span,{className:"hljs-punctuation",children:"->"})," ",(0,l.jsx)(e.span,{className:"hljs-type",children:"Box"}),"<",(0,l.jsx)(e.span,{className:"hljs-keyword",children:"dyn"})," State> {\n		 	",(0,l.jsx)(e.span,{className:"hljs-type",children:"Box"}),"::",(0,l.jsx)(e.span,{className:"hljs-title function_ invoke__",children:"new"}),"(Draft {})\n		 }\n	}\n	\n	",(0,l.jsx)(e.span,{className:"hljs-keyword",children:"struct"})," ",(0,l.jsx)(e.span,{className:"hljs-title class_",children:"Published"})," {}\n	\n	",(0,l.jsx)(e.span,{className:"hljs-keyword",children:"impl"})," ",(0,l.jsx)(e.span,{className:"hljs-title class_",children:"State"})," ",(0,l.jsx)(e.span,{className:"hljs-keyword",children:"for"})," ",(0,l.jsx)(e.span,{className:"hljs-title class_",children:"Published"})," {\n		",(0,l.jsx)(e.span,{className:"hljs-keyword",children:"fn"})," ",(0,l.jsx)(e.span,{className:"hljs-title function_",children:"request_review"}),"(",(0,l.jsx)(e.span,{className:"hljs-keyword",children:"self"}),": ",(0,l.jsx)(e.span,{className:"hljs-type",children:"Box"}),"<",(0,l.jsx)(e.span,{className:"hljs-keyword",children:"Self"}),">) ",(0,l.jsx)(e.span,{className:"hljs-punctuation",children:"->"})," ",(0,l.jsx)(e.span,{className:"hljs-type",children:"Box"}),"<",(0,l.jsx)(e.span,{className:"hljs-keyword",children:"dyn"})," State> {\n			",(0,l.jsx)(e.span,{className:"hljs-keyword",children:"self"}),"\n		}\n		\n		",(0,l.jsx)(e.span,{className:"hljs-keyword",children:"fn"})," ",(0,l.jsx)(e.span,{className:"hljs-title function_",children:"approve"}),"(",(0,l.jsx)(e.span,{className:"hljs-keyword",children:"self"}),": ",(0,l.jsx)(e.span,{className:"hljs-type",children:"Box"}),"<",(0,l.jsx)(e.span,{className:"hljs-keyword",children:"Self"}),">) ",(0,l.jsx)(e.span,{className:"hljs-punctuation",children:"->"})," ",(0,l.jsx)(e.span,{className:"hljs-type",children:"Box"}),"<",(0,l.jsx)(e.span,{className:"hljs-keyword",children:"dyn"})," State> {\n		 	",(0,l.jsx)(e.span,{className:"hljs-keyword",children:"self"}),"\n		 }\n		 \n		",(0,l.jsx)(e.span,{className:"hljs-keyword",children:"fn"})," ",(0,l.jsx)(e.span,{className:"hljs-title function_",children:"reject"}),"(",(0,l.jsx)(e.span,{className:"hljs-keyword",children:"self"}),": ",(0,l.jsx)(e.span,{className:"hljs-type",children:"Box"}),"<",(0,l.jsx)(e.span,{className:"hljs-keyword",children:"Self"}),">) ",(0,l.jsx)(e.span,{className:"hljs-punctuation",children:"->"})," ",(0,l.jsx)(e.span,{className:"hljs-type",children:"Box"}),"<",(0,l.jsx)(e.span,{className:"hljs-keyword",children:"dyn"})," State> {\n		 	",(0,l.jsx)(e.span,{className:"hljs-keyword",children:"self"}),"\n		 }\n		 \n		",(0,l.jsx)(e.span,{className:"hljs-keyword",children:"fn"})," ",(0,l.jsx)(e.span,{className:"hljs-title function_",children:"content"}),"<",(0,l.jsx)(e.span,{className:"hljs-symbol",children:"'a"}),">(&",(0,l.jsx)(e.span,{className:"hljs-keyword",children:"self"}),", post: &",(0,l.jsx)(e.span,{className:"hljs-symbol",children:"'a"})," Post) ",(0,l.jsx)(e.span,{className:"hljs-punctuation",children:"->"})," &",(0,l.jsx)(e.span,{className:"hljs-symbol",children:"'a"})," ",(0,l.jsx)(e.span,{className:"hljs-type",children:"str"})," {\n			&post.content\n		}\n	}\n}\n"]})}),"\n",(0,l.jsx)(e.h2,{children:"Refinement"}),"\n",(0,l.jsx)(e.p,{children:"Now, what can be learned from asking ChatGPT?"}),"\n",(0,l.jsx)(e.p,{children:"Open AI's ChatGPT prompt."}),"\n",(0,l.jsx)(e.pre,{children:(0,l.jsx)(e.code,{children:"Refactor this code to be more performant.\n"})}),"\n",(0,l.jsx)(e.h3,{children:"Response"}),"\n",(0,l.jsxs)(e.p,{children:["One possible way to make the code more performant is to avoid unnecessary allocations and cloning of data. One such example is in the ",(0,l.jsx)(e.code,{children:"content()"})," method of the ",(0,l.jsx)(e.code,{children:"State"})," trait, where the content is cloned unnecessarily."]}),"\n",(0,l.jsxs)(e.ol,{children:["\n",(0,l.jsx)(e.li,{children:"Instead, we can use a reference to the existing content to avoid the clone:"}),"\n"]}),"\n",(0,l.jsx)(e.pre,{children:(0,l.jsxs)(e.code,{className:"hljs language-rust",children:[(0,l.jsx)(e.span,{className:"hljs-keyword",children:"fn"})," ",(0,l.jsx)(e.span,{className:"hljs-title function_",children:"content"}),"<",(0,l.jsx)(e.span,{className:"hljs-symbol",children:"'a"}),">(&",(0,l.jsx)(e.span,{className:"hljs-keyword",children:"self"}),", post: &",(0,l.jsx)(e.span,{className:"hljs-symbol",children:"'a"})," Post) ",(0,l.jsx)(e.span,{className:"hljs-punctuation",children:"->"})," &",(0,l.jsx)(e.span,{className:"hljs-symbol",children:"'a"})," ",(0,l.jsx)(e.span,{className:"hljs-type",children:"str"})," {\n    &post.content\n}\n"]})}),"\n",(0,l.jsxs)(e.ol,{start:"2",children:["\n",(0,l.jsxs)(e.li,{children:["Similarly, in the ",(0,l.jsx)(e.code,{children:"add_text()"})," method of the ",(0,l.jsx)(e.code,{children:"Post"})," struct, we can use a reference to the text to avoid the allocation and copying of the string:"]}),"\n"]}),"\n",(0,l.jsx)(e.pre,{children:(0,l.jsxs)(e.code,{className:"hljs language-rust",children:[(0,l.jsx)(e.span,{className:"hljs-keyword",children:"pub"})," ",(0,l.jsx)(e.span,{className:"hljs-keyword",children:"fn"})," ",(0,l.jsx)(e.span,{className:"hljs-title function_",children:"add_text"}),"(&",(0,l.jsx)(e.span,{className:"hljs-keyword",children:"mut"})," ",(0,l.jsx)(e.span,{className:"hljs-keyword",children:"self"}),", text: &",(0,l.jsx)(e.span,{className:"hljs-type",children:"str"}),") {\n    ",(0,l.jsx)(e.span,{className:"hljs-keyword",children:"if"})," ",(0,l.jsx)(e.span,{className:"hljs-keyword",children:"let"})," ",(0,l.jsx)(e.span,{className:"hljs-variable",children:"Some"}),"(s) = ",(0,l.jsx)(e.span,{className:"hljs-keyword",children:"self"}),".state.",(0,l.jsx)(e.span,{className:"hljs-title function_ invoke__",children:"as_ref"}),"() {\n        ",(0,l.jsx)(e.span,{className:"hljs-keyword",children:"if"})," s.",(0,l.jsx)(e.span,{className:"hljs-title function_ invoke__",children:"can_add_content"}),"() {\n            ",(0,l.jsx)(e.span,{className:"hljs-keyword",children:"self"}),".content.",(0,l.jsx)(e.span,{className:"hljs-title function_ invoke__",children:"push_str"}),"(text);\n        }\n    }\n}\n"]})}),"\n",(0,l.jsxs)(e.ol,{start:"3",children:["\n",(0,l.jsx)(e.li,{children:"We can also avoid unnecessary boxing and dynamic dispatch by using an enum instead of a trait object for the state of the post. This can simplify the code and make it more efficient:"}),"\n"]}),"\n",(0,l.jsx)(e.pre,{children:(0,l.jsxs)(e.code,{className:"hljs language-rust",children:[(0,l.jsx)(e.span,{className:"hljs-keyword",children:"mod"})," blog {\n    ",(0,l.jsx)(e.span,{className:"hljs-keyword",children:"pub"})," ",(0,l.jsx)(e.span,{className:"hljs-keyword",children:"struct"})," ",(0,l.jsx)(e.span,{className:"hljs-title class_",children:"Post"})," {\n        state: State,\n        content: ",(0,l.jsx)(e.span,{className:"hljs-type",children:"String"}),",\n    }\n\n    ",(0,l.jsx)(e.span,{className:"hljs-meta",children:"#[derive(Debug)]"}),"\n    ",(0,l.jsx)(e.span,{className:"hljs-keyword",children:"enum"})," ",(0,l.jsx)(e.span,{className:"hljs-title class_",children:"State"})," {\n        Draft { can_add_content: ",(0,l.jsx)(e.span,{className:"hljs-type",children:"bool"})," },\n        PendingReview { reviews: ",(0,l.jsx)(e.span,{className:"hljs-type",children:"i8"})," },\n        Published,\n    }\n\n    ",(0,l.jsx)(e.span,{className:"hljs-keyword",children:"impl"})," ",(0,l.jsx)(e.span,{className:"hljs-title class_",children:"Post"})," {\n        ",(0,l.jsx)(e.span,{className:"hljs-keyword",children:"pub"})," ",(0,l.jsx)(e.span,{className:"hljs-keyword",children:"fn"})," ",(0,l.jsx)(e.span,{className:"hljs-title function_",children:"new"}),"() ",(0,l.jsx)(e.span,{className:"hljs-punctuation",children:"->"})," Post {\n            Post {\n                state: State::Draft { can_add_content: ",(0,l.jsx)(e.span,{className:"hljs-literal",children:"true"})," },\n                content: ",(0,l.jsx)(e.span,{className:"hljs-type",children:"String"}),"::",(0,l.jsx)(e.span,{className:"hljs-title function_ invoke__",children:"new"}),"(),\n            }\n        }\n\n        ",(0,l.jsx)(e.span,{className:"hljs-keyword",children:"pub"})," ",(0,l.jsx)(e.span,{className:"hljs-keyword",children:"fn"})," ",(0,l.jsx)(e.span,{className:"hljs-title function_",children:"add_text"}),"(&",(0,l.jsx)(e.span,{className:"hljs-keyword",children:"mut"})," ",(0,l.jsx)(e.span,{className:"hljs-keyword",children:"self"}),", text: &",(0,l.jsx)(e.span,{className:"hljs-type",children:"str"}),") {\n            ",(0,l.jsx)(e.span,{className:"hljs-keyword",children:"if"})," ",(0,l.jsx)(e.span,{className:"hljs-keyword",children:"let"})," ",(0,l.jsx)(e.span,{className:"hljs-variable",children:"State"}),"::Draft { can_add_content: ",(0,l.jsx)(e.span,{className:"hljs-literal",children:"true"})," } = ",(0,l.jsx)(e.span,{className:"hljs-keyword",children:"self"}),".state {\n                ",(0,l.jsx)(e.span,{className:"hljs-keyword",children:"self"}),".content.",(0,l.jsx)(e.span,{className:"hljs-title function_ invoke__",children:"push_str"}),"(text);\n            }\n        }\n\n        ",(0,l.jsx)(e.span,{className:"hljs-keyword",children:"pub"})," ",(0,l.jsx)(e.span,{className:"hljs-keyword",children:"fn"})," ",(0,l.jsx)(e.span,{className:"hljs-title function_",children:"content"}),"(&",(0,l.jsx)(e.span,{className:"hljs-keyword",children:"self"}),") ",(0,l.jsx)(e.span,{className:"hljs-punctuation",children:"->"})," &",(0,l.jsx)(e.span,{className:"hljs-type",children:"str"})," {\n            ",(0,l.jsx)(e.span,{className:"hljs-keyword",children:"if"})," ",(0,l.jsx)(e.span,{className:"hljs-keyword",children:"let"})," ",(0,l.jsx)(e.span,{className:"hljs-variable",children:"State"}),"::Published = ",(0,l.jsx)(e.span,{className:"hljs-keyword",children:"self"}),".state {\n                &",(0,l.jsx)(e.span,{className:"hljs-keyword",children:"self"}),".content\n            } ",(0,l.jsx)(e.span,{className:"hljs-keyword",children:"else"})," {\n                ",(0,l.jsx)(e.span,{className:"hljs-string",children:'""'}),"\n            }\n        }\n\n        ",(0,l.jsx)(e.span,{className:"hljs-keyword",children:"pub"})," ",(0,l.jsx)(e.span,{className:"hljs-keyword",children:"fn"})," ",(0,l.jsx)(e.span,{className:"hljs-title function_",children:"request_review"}),"(&",(0,l.jsx)(e.span,{className:"hljs-keyword",children:"mut"})," ",(0,l.jsx)(e.span,{className:"hljs-keyword",children:"self"}),") {\n            ",(0,l.jsx)(e.span,{className:"hljs-keyword",children:"if"})," ",(0,l.jsx)(e.span,{className:"hljs-keyword",children:"let"})," ",(0,l.jsx)(e.span,{className:"hljs-variable",children:"State"}),"::Draft { .. } = ",(0,l.jsx)(e.span,{className:"hljs-keyword",children:"self"}),".state {\n                ",(0,l.jsx)(e.span,{className:"hljs-keyword",children:"self"}),".state = State::PendingReview { reviews: ",(0,l.jsx)(e.span,{className:"hljs-number",children:"0"})," };\n            }\n        }\n\n        ",(0,l.jsx)(e.span,{className:"hljs-keyword",children:"pub"})," ",(0,l.jsx)(e.span,{className:"hljs-keyword",children:"fn"})," ",(0,l.jsx)(e.span,{className:"hljs-title function_",children:"approve"}),"(&",(0,l.jsx)(e.span,{className:"hljs-keyword",children:"mut"})," ",(0,l.jsx)(e.span,{className:"hljs-keyword",children:"self"}),") {\n            ",(0,l.jsx)(e.span,{className:"hljs-keyword",children:"if"})," ",(0,l.jsx)(e.span,{className:"hljs-keyword",children:"let"})," ",(0,l.jsx)(e.span,{className:"hljs-variable",children:"State"}),"::PendingReview { reviews } = &",(0,l.jsx)(e.span,{className:"hljs-keyword",children:"mut"})," ",(0,l.jsx)(e.span,{className:"hljs-keyword",children:"self"}),".state {\n                *reviews += ",(0,l.jsx)(e.span,{className:"hljs-number",children:"1"}),";\n                ",(0,l.jsx)(e.span,{className:"hljs-keyword",children:"if"})," *reviews >= ",(0,l.jsx)(e.span,{className:"hljs-number",children:"2"})," {\n                    ",(0,l.jsx)(e.span,{className:"hljs-keyword",children:"self"}),".state = State::Published;\n                }\n            }\n        }\n\n        ",(0,l.jsx)(e.span,{className:"hljs-keyword",children:"pub"})," ",(0,l.jsx)(e.span,{className:"hljs-keyword",children:"fn"})," ",(0,l.jsx)(e.span,{className:"hljs-title function_",children:"reject"}),"(&",(0,l.jsx)(e.span,{className:"hljs-keyword",children:"mut"})," ",(0,l.jsx)(e.span,{className:"hljs-keyword",children:"self"}),") {\n            ",(0,l.jsx)(e.span,{className:"hljs-keyword",children:"if"})," ",(0,l.jsx)(e.span,{className:"hljs-keyword",children:"let"})," ",(0,l.jsx)(e.span,{className:"hljs-variable",children:"State"}),"::PendingReview { .. } = ",(0,l.jsx)(e.span,{className:"hljs-keyword",children:"self"}),".state {\n                ",(0,l.jsx)(e.span,{className:"hljs-keyword",children:"self"}),".state = State::Draft { can_add_content: ",(0,l.jsx)(e.span,{className:"hljs-literal",children:"true"})," };\n            }\n        }\n    }\n}\n"]})}),"\n",(0,l.jsx)(e.p,{children:"With these changes, the code should be more efficient and performant."}),"\n",(0,l.jsx)(e.h2,{children:"Summary"}),"\n",(0,l.jsxs)(e.p,{children:["For the first two points, as best I can tell, it is already happening. And the last point is fair and even called out in the rusty book. We used ",(0,l.jsx)(e.code,{children:"Box"}),"s to show how they work with ",(0,l.jsx)(e.code,{children:"dyn trait"}),"s. Overall because I didn't come up with a majority of the code it didn't leave a lot of room for ChatGPT to fix it."]})]})}function r(s={}){return(0,l.jsx)(h,{...s,children:(0,l.jsx)(i,{...s})})}}},s=>{s.O(0,[636,593,792],()=>s(s.s=7898)),_N_E=s.O()}]);